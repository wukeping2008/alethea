<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»¿çœŸå®éªŒ - Alethea Enhanced</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Global Theme CSS -->
    <link rel="stylesheet" href="/static/css/global-theme.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .experiment-card {
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .experiment-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border-color: #3b82f6;
        }

        .subject-tab {
            transition: all 0.3s ease;
        }

        .subject-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .modal-overlay {
            backdrop-filter: blur(8px);
        }

        .loading-spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body class="bg-gray-50 min-h-screen">
    <!-- å¯¼èˆªæ  -->
    <nav class="bg-white shadow-lg border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <img src="logo.png" alt="Alethea" class="h-8 w-8 mr-3">
                    <span class="text-xl font-bold text-gray-900">Alethea Enhanced</span>
                </div>
                <div class="flex items-center space-x-8">
                    <a href="index.html" class="text-gray-600 hover:text-blue-600 transition-colors">é¦–é¡µ</a>
                    <a href="index.html#subjects" class="text-gray-600 hover:text-blue-600 transition-colors">å­¦ç§‘</a>
                    <a href="projects.html" class="text-gray-600 hover:text-blue-600 transition-colors">é¡¹ç›®åˆ¶å­¦ä¹ </a>
                    <a href="experiments.html" class="text-blue-600 font-medium">å®éªŒä»¿çœŸ</a>
                    <a href="dashboard.html" class="text-gray-600 hover:text-blue-600 transition-colors">å­¦ä¹ åˆ†æ</a>
                    <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-100 transition-colors">
                        <i class="fas fa-moon"></i>
                    </button>
                    <div class="relative">
                        <button id="userMenuBtn"
                            class="flex items-center text-gray-600 hover:text-blue-600 transition-colors">
                            <i class="fas fa-user-circle text-xl mr-1"></i>
                            <span>ç”¨æˆ·</span>
                            <i class="fas fa-chevron-down ml-1 text-sm"></i>
                        </button>
                        <div id="userMenu"
                            class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50">
                            <a href="profile.html"
                                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">ä¸ªäººèµ„æ–™</a>
                            <a href="settings.html"
                                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">è®¾ç½®</a>
                            <hr class="my-1">
                            <a href="login.html"
                                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">é€€å‡ºç™»å½•</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- ä¸»è¦å†…å®¹ -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- é¡µé¢æ ‡é¢˜ -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">
                <i class="fas fa-flask text-blue-600 mr-3"></i>
                ä»¿çœŸå®éªŒå¹³å°
            </h1>
            <p class="text-gray-600">é€‰æ‹©å®éªŒä¸»é¢˜ï¼ŒAIå°†ä¸ºæ‚¨ç”Ÿæˆä¸ªæ€§åŒ–çš„å®éªŒå†…å®¹å’Œåœ¨çº¿ä»¿çœŸç¯å¢ƒ</p>
        </div>

        <!-- å­¦ç§‘æ ‡ç­¾é¡µ -->
        <div class="mb-8">
            <div class="flex flex-wrap gap-2 mb-6">
                <button class="subject-tab active px-6 py-3 rounded-lg font-medium transition-all" data-subject="all">
                    <i class="fas fa-th-large mr-2"></i>å…¨éƒ¨å®éªŒ
                </button>
                <button class="subject-tab px-6 py-3 rounded-lg font-medium bg-white text-gray-700 hover:bg-gray-50"
                    data-subject="circuit">
                    <i class="fas fa-bolt mr-2"></i>ç”µè·¯åˆ†æ
                </button>
                <button class="subject-tab px-6 py-3 rounded-lg font-medium bg-white text-gray-700 hover:bg-gray-50"
                    data-subject="digital">
                    <i class="fas fa-microchip mr-2"></i>æ•°å­—ç”µè·¯
                </button>
                <button class="subject-tab px-6 py-3 rounded-lg font-medium bg-white text-gray-700 hover:bg-gray-50"
                    data-subject="analog">
                    <i class="fas fa-wave-square mr-2"></i>æ¨¡æ‹Ÿç”µè·¯
                </button>
                <button class="subject-tab px-6 py-3 rounded-lg font-medium bg-white text-gray-700 hover:bg-gray-50"
                    data-subject="signal">
                    <i class="fas fa-signal mr-2"></i>ä¿¡å·ä¸ç³»ç»Ÿ
                </button>
                <button class="subject-tab px-6 py-3 rounded-lg font-medium bg-white text-gray-700 hover:bg-gray-50"
                    data-subject="communication">
                    <i class="fas fa-broadcast-tower mr-2"></i>é€šä¿¡åŸç†
                </button>
                <button class="subject-tab px-6 py-3 rounded-lg font-medium bg-white text-gray-700 hover:bg-gray-50"
                    data-subject="embedded">
                    <i class="fas fa-memory mr-2"></i>åµŒå…¥å¼ç³»ç»Ÿ
                </button>
            </div>
        </div>

        <!-- å®éªŒæ¨¡å—åˆ—è¡¨ -->
        <div id="experimentsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- å®éªŒå¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>
    </div>

    <!-- å®éªŒè¯¦æƒ…æ¨¡æ€æ¡† -->
    <div id="experimentModal"
        class="hidden fixed inset-0 bg-black bg-opacity-50 modal-overlay z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden">
            <div class="flex justify-between items-center p-6 border-b border-gray-200">
                <h3 id="modalTitle" class="text-xl font-bold text-gray-900"></h3>
                <button id="closeModal" class="text-gray-400 hover:text-gray-600 transition-colors">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="p-6 overflow-y-auto max-h-[calc(90vh-120px)]">
                <div id="modalContent">
                    <!-- æ¨¡æ€æ¡†å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <!-- AIåŠ©æ‰‹æµ®åŠ¨æŒ‰é’® -->
    <div class="fixed bottom-6 right-6 z-40">
        <button id="aiAssistantBtn"
            class="bg-blue-600 hover:bg-blue-700 text-white rounded-full p-4 shadow-lg transition-all duration-300 hover:scale-110">
            <i class="fas fa-robot text-xl"></i>
        </button>
    </div>

    <!-- AIåŠ©æ‰‹èŠå¤©çª—å£ -->
    <div id="aiChatWindow"
        class="hidden fixed bottom-24 right-6 w-80 h-96 bg-white rounded-lg shadow-2xl border border-gray-200 z-50">
        <div class="flex justify-between items-center p-4 border-b border-gray-200 bg-blue-600 text-white rounded-t-lg">
            <h4 class="font-medium">AIå®éªŒåŠ©æ‰‹</h4>
            <button id="closeChatBtn" class="text-white hover:text-gray-200">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div id="chatMessages" class="flex-1 p-4 overflow-y-auto h-64 space-y-3">
            <div class="bg-blue-100 rounded-lg p-3">
                <p class="text-sm text-blue-800">ğŸ‘‹ ä½ å¥½ï¼æˆ‘æ˜¯AIå®éªŒåŠ©æ‰‹ï¼Œå¯ä»¥å¸®ä½ è§£ç­”å®éªŒç›¸å…³é—®é¢˜ã€‚</p>
            </div>
        </div>
        <div class="p-4 border-t border-gray-200">
            <div class="flex gap-2">
                <input type="text" id="chatInput" placeholder="è¾“å…¥ä½ çš„é—®é¢˜..."
                    class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <button id="sendChatBtn"
                    class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        // å®éªŒæ¨¡å—æ•°æ®
        const experimentModules = {
            circuit: [
                {
                    id: 'circuit_ohm',
                    title: 'æ¬§å§†å®šå¾‹éªŒè¯',
                    description: 'é€šè¿‡æ”¹å˜ç”µé˜»å€¼ï¼Œè§‚å¯Ÿç”µå‹å’Œç”µæµçš„å…³ç³»ï¼ŒéªŒè¯æ¬§å§†å®šå¾‹',
                    icon: 'fas fa-bolt',
                    color: 'blue',
                    subject: 'circuit'
                },
                {
                    id: 'circuit_rc',
                    title: 'RCç”µè·¯åˆ†æ',
                    description: 'åˆ†æRCç”µè·¯çš„å……æ”¾ç”µè¿‡ç¨‹ï¼Œç†è§£æ—¶é—´å¸¸æ•°çš„æ¦‚å¿µ',
                    icon: 'fas fa-chart-line',
                    color: 'green',
                    subject: 'circuit'
                },
                {
                    id: 'circuit_thevenin',
                    title: 'æˆ´ç»´å—ç­‰æ•ˆç”µè·¯',
                    description: 'éªŒè¯æˆ´ç»´å—å®šç†ï¼Œæ±‚è§£å¤æ‚ç”µè·¯çš„ç­‰æ•ˆç”µè·¯',
                    icon: 'fas fa-project-diagram',
                    color: 'purple',
                    subject: 'circuit'
                },
                {
                    id: 'circuit_rlc',
                    title: 'RLCè°æŒ¯ç”µè·¯',
                    description: 'ç ”ç©¶RLCä¸²è”è°æŒ¯ç”µè·¯çš„é¢‘ç‡ç‰¹æ€§å’Œå“è´¨å› æ•°',
                    icon: 'fas fa-wave-square',
                    color: 'indigo',
                    subject: 'circuit'
                }
            ],
            digital: [
                {
                    id: 'digital_gates',
                    title: 'é€»è¾‘é—¨ç‰¹æ€§',
                    description: 'æµ‹è¯•å„ç§é€»è¾‘é—¨çš„çœŸå€¼è¡¨ï¼Œç†è§£æ•°å­—é€»è¾‘åŸºç¡€',
                    icon: 'fas fa-microchip',
                    color: 'cyan',
                    subject: 'digital'
                },
                {
                    id: 'digital_combinational',
                    title: 'ç»„åˆé€»è¾‘è®¾è®¡',
                    description: 'è®¾è®¡å¹¶å®ç°å¤šè·¯é€‰æ‹©å™¨ï¼ŒæŒæ¡ç»„åˆé€»è¾‘è®¾è®¡æ–¹æ³•',
                    icon: 'fas fa-sitemap',
                    color: 'teal',
                    subject: 'digital'
                },
                {
                    id: 'digital_counter',
                    title: 'è®¡æ•°å™¨è®¾è®¡',
                    description: 'è®¾è®¡åŒæ­¥äºŒè¿›åˆ¶è®¡æ•°å™¨ï¼Œç†è§£æ—¶åºç”µè·¯åŸç†',
                    icon: 'fas fa-stopwatch',
                    color: 'red',
                    subject: 'digital'
                },
                {
                    id: 'digital_flipflop',
                    title: 'è§¦å‘å™¨åº”ç”¨',
                    description: 'å­¦ä¹ å„ç§è§¦å‘å™¨çš„å·¥ä½œåŸç†å’Œåº”ç”¨åœºæ™¯',
                    icon: 'fas fa-toggle-on',
                    color: 'orange',
                    subject: 'digital'
                }
            ],
            analog: [
                {
                    id: 'analog_transistor',
                    title: 'ä¸‰æç®¡ç‰¹æ€§',
                    description: 'æµ‹é‡ä¸‰æç®¡çš„è¾“å…¥è¾“å‡ºç‰¹æ€§ï¼Œç†è§£ä¸‰æç®¡å·¥ä½œåŸç†',
                    icon: 'fas fa-wave-square',
                    color: 'orange',
                    subject: 'analog'
                },
                {
                    id: 'analog_opamp',
                    title: 'è¿æ”¾åŸºæœ¬ç”µè·¯',
                    description: 'å®ç°åç›¸æ”¾å¤§å™¨å’ŒåŒç›¸æ”¾å¤§å™¨ï¼ŒæŒæ¡è¿æ”¾åº”ç”¨',
                    icon: 'fas fa-expand-arrows-alt',
                    color: 'pink',
                    subject: 'analog'
                },
                {
                    id: 'analog_filter',
                    title: 'æ»¤æ³¢å™¨è®¾è®¡',
                    description: 'è®¾è®¡ä½é€šã€é«˜é€šã€å¸¦é€šæ»¤æ³¢å™¨ï¼Œåˆ†æé¢‘ç‡å“åº”',
                    icon: 'fas fa-filter',
                    color: 'emerald',
                    subject: 'analog'
                },
                {
                    id: 'analog_oscillator',
                    title: 'æŒ¯è¡å™¨ç”µè·¯',
                    description: 'è®¾è®¡æ­£å¼¦æ³¢å’Œæ–¹æ³¢æŒ¯è¡å™¨ï¼Œç†è§£æŒ¯è¡æ¡ä»¶',
                    icon: 'fas fa-broadcast-tower',
                    color: 'violet',
                    subject: 'analog'
                }
            ],
            signal: [
                {
                    id: 'signal_time',
                    title: 'ä¿¡å·æ—¶åŸŸåˆ†æ',
                    description: 'åˆ†æå„ç§åŸºæœ¬ä¿¡å·çš„æ—¶åŸŸç‰¹æ€§ï¼ŒæŒæ¡ä¿¡å·åˆ†ææ–¹æ³•',
                    icon: 'fas fa-chart-area',
                    color: 'cyan',
                    subject: 'signal'
                },
                {
                    id: 'signal_fourier',
                    title: 'å‚…é‡Œå¶å˜æ¢',
                    description: 'ä½¿ç”¨MATLABåˆ†æä¿¡å·é¢‘è°±ï¼Œç†è§£å‚…é‡Œå¶å˜æ¢',
                    icon: 'fas fa-wave-square',
                    color: 'lime',
                    subject: 'signal'
                },
                {
                    id: 'signal_sampling',
                    title: 'é‡‡æ ·å®šç†éªŒè¯',
                    description: 'éªŒè¯å¥ˆå¥æ–¯ç‰¹é‡‡æ ·å®šç†ï¼Œç†è§£æ··å ç°è±¡',
                    icon: 'fas fa-chart-line',
                    color: 'amber',
                    subject: 'signal'
                },
                {
                    id: 'signal_convolution',
                    title: 'å·ç§¯è¿ç®—',
                    description: 'ç†è§£å·ç§¯çš„ç‰©ç†æ„ä¹‰ï¼ŒæŒæ¡ç³»ç»Ÿå“åº”åˆ†æ',
                    icon: 'fas fa-calculator',
                    color: 'rose',
                    subject: 'signal'
                }
            ],
            communication: [
                {
                    id: 'comm_am',
                    title: 'AMè°ƒåˆ¶è§£è°ƒ',
                    description: 'å®ç°AMè°ƒåˆ¶å’Œè§£è°ƒï¼Œç†è§£æ¨¡æ‹Ÿè°ƒåˆ¶åŸç†',
                    icon: 'fas fa-radio',
                    color: 'amber',
                    subject: 'communication'
                },
                {
                    id: 'comm_fm',
                    title: 'FMè°ƒåˆ¶è§£è°ƒ',
                    description: 'å®ç°FMè°ƒåˆ¶å’Œè§£è°ƒï¼Œæ¯”è¾ƒä¸åŒè°ƒåˆ¶æ–¹å¼',
                    icon: 'fas fa-satellite',
                    color: 'sky',
                    subject: 'communication'
                },
                {
                    id: 'comm_digital',
                    title: 'æ•°å­—è°ƒåˆ¶',
                    description: 'å­¦ä¹ ASKã€FSKã€PSKç­‰æ•°å­—è°ƒåˆ¶æŠ€æœ¯',
                    icon: 'fas fa-wifi',
                    color: 'emerald',
                    subject: 'communication'
                },
                {
                    id: 'comm_channel',
                    title: 'ä¿¡é“ç¼–ç ',
                    description: 'ç†è§£ä¿¡é“ç¼–ç åŸç†ï¼Œå®ç°é”™è¯¯æ£€æµ‹å’Œçº æ­£',
                    icon: 'fas fa-shield-alt',
                    color: 'indigo',
                    subject: 'communication'
                }
            ],
            embedded: [
                {
                    id: 'embedded_gpio',
                    title: 'GPIOæ§åˆ¶',
                    description: 'STM32å¾®æ§åˆ¶å™¨çš„GPIOæ§åˆ¶å’ŒåŸºæœ¬åº”ç”¨',
                    icon: 'fas fa-microchip',
                    color: 'slate',
                    subject: 'embedded'
                },
                {
                    id: 'embedded_timer',
                    title: 'å®šæ—¶å™¨åº”ç”¨',
                    description: 'å­¦ä¹ å®šæ—¶å™¨çš„é…ç½®å’Œä¸­æ–­å¤„ç†',
                    icon: 'fas fa-clock',
                    color: 'blue',
                    subject: 'embedded'
                },
                {
                    id: 'embedded_adc',
                    title: 'ADCæ•°æ®é‡‡é›†',
                    description: 'ä½¿ç”¨ADCè¿›è¡Œæ¨¡æ‹Ÿä¿¡å·é‡‡é›†å’Œå¤„ç†',
                    icon: 'fas fa-chart-bar',
                    color: 'green',
                    subject: 'embedded'
                },
                {
                    id: 'embedded_uart',
                    title: 'ä¸²å£é€šä¿¡',
                    description: 'å®ç°UARTä¸²å£é€šä¿¡å’Œæ•°æ®ä¼ è¾“',
                    icon: 'fas fa-exchange-alt',
                    color: 'purple',
                    subject: 'embedded'
                }
            ]
        };

        // è·å–æ‰€æœ‰å®éªŒæ¨¡å—
        function getAllExperiments() {
            const allExperiments = [];
            Object.keys(experimentModules).forEach(subject => {
                experimentModules[subject].forEach(exp => {
                    allExperiments.push({ ...exp, subject });
                });
            });
            return allExperiments;
        }

        // æ¸²æŸ“å®éªŒå¡ç‰‡
        function renderExperiments(experiments) {
            const container = document.getElementById('experimentsContainer');
            container.innerHTML = '';

            experiments.forEach(exp => {
                const card = document.createElement('div');
                card.className = 'experiment-card bg-white rounded-xl shadow-md p-6 cursor-pointer hover:shadow-lg transition-all';
                card.innerHTML = `
                    <div class="flex items-center mb-4">
                        <div class="p-4 bg-${exp.color}-100 rounded-lg mr-4">
                            <i class="${exp.icon} text-${exp.color}-600 text-2xl"></i>
                        </div>
                        <div class="flex-1">
                            <h3 class="text-xl font-semibold text-gray-900 mb-1">${exp.title}</h3>
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-${exp.color}-100 text-${exp.color}-800">
                                ${getSubjectName(exp.subject)}
                            </span>
                        </div>
                    </div>
                    <p class="text-gray-600 text-sm mb-6 line-clamp-2">${exp.description}</p>
                    <div class="flex justify-between items-center">
                        <div class="flex items-center text-sm text-gray-500">
                            <i class="fas fa-magic mr-2"></i>
                            <span>AIç”Ÿæˆå®éªŒ</span>
                        </div>
                        <button class="bg-${exp.color}-600 hover:bg-${exp.color}-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                            å¼€å§‹å®éªŒ
                        </button>
                    </div>
                `;

                card.addEventListener('click', () => generateExperiment(exp));
                container.appendChild(card);
            });
        }

        // è·å–å­¦ç§‘åç§°
        function getSubjectName(subject) {
            const names = {
                'circuit': 'ç”µè·¯åˆ†æ',
                'digital': 'æ•°å­—ç”µè·¯',
                'analog': 'æ¨¡æ‹Ÿç”µè·¯',
                'signal': 'ä¿¡å·ä¸ç³»ç»Ÿ',
                'communication': 'é€šä¿¡åŸç†',
                'embedded': 'åµŒå…¥å¼ç³»ç»Ÿ'
            };
            return names[subject] || 'å®éªŒ';
        }

        // AIç”Ÿæˆå®éªŒå†…å®¹
        async function generateExperiment(experiment) {
            const modal = document.getElementById('experimentModal');
            const title = document.getElementById('modalTitle');
            const content = document.getElementById('modalContent');

            title.textContent = experiment.title;

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            content.innerHTML = `
                <div class="flex flex-col items-center justify-center py-12">
                    <div class="loading-spinner mb-4"></div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">AIæ­£åœ¨ç”Ÿæˆå®éªŒå†…å®¹...</h3>
                    <p class="text-gray-600 text-center">è¯·ç¨å€™ï¼Œæˆ‘ä»¬æ­£åœ¨ä¸ºæ‚¨å®šåˆ¶ä¸“å±çš„å®éªŒæ–¹æ¡ˆ</p>
                </div>
            `;

            modal.classList.remove('hidden');

            try {
                // è°ƒç”¨AIç”Ÿæˆå®éªŒå†…å®¹
                const response = await fetch('/api/experiments/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        experiment_id: experiment.id,
                        title: experiment.title,
                        description: experiment.description,
                        subject: experiment.subject,
                        language: 'zh'
                    })
                });

                const data = await response.json();

                if (data.success) {
                    // æ˜¾ç¤ºç”Ÿæˆçš„å®éªŒå†…å®¹
                    displayGeneratedExperiment(data.experiment, experiment);
                } else {
                    // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                    content.innerHTML = `
                        <div class="text-center py-12">
                            <i class="fas fa-exclamation-triangle text-4xl text-yellow-500 mb-4"></i>
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">ç”Ÿæˆå¤±è´¥</h3>
                            <p class="text-gray-600 mb-4">æŠ±æ­‰ï¼ŒAIå®éªŒç”Ÿæˆæš‚æ—¶ä¸å¯ç”¨</p>
                            <button onclick="generateExperiment({id: '${experiment.id}', title: '${experiment.title}', description: '${experiment.description}', subject: '${experiment.subject}'})" 
                                    class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                                é‡è¯•
                            </button>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('ç”Ÿæˆå®éªŒå†…å®¹å¤±è´¥:', error);
                // æ˜¾ç¤ºå¤‡ç”¨å†…å®¹
                displayFallbackExperiment(experiment);
            }
        }

        // æ˜¾ç¤ºç”Ÿæˆçš„å®éªŒå†…å®¹
        function displayGeneratedExperiment(experimentData, originalExp) {
            const content = document.getElementById('modalContent');

            content.innerHTML = `
                <div class="space-y-6">
                    <!-- å®éªŒæ¦‚è§ˆ -->
                    <div class="bg-gradient-to-r from-${originalExp.color}-50 to-${originalExp.color}-100 rounded-lg p-6">
                        <div class="flex items-start">
                            <div class="p-3 bg-${originalExp.color}-200 rounded-lg mr-4">
                                <i class="${originalExp.icon} text-${originalExp.color}-700 text-2xl"></i>
                            </div>
                            <div class="flex-1">
                                <h4 class="text-lg font-semibold text-gray-900 mb-2">å®éªŒæ¦‚è§ˆ</h4>
                                <p class="text-gray-700">${experimentData.overview || originalExp.description}</p>
                                <div class="mt-4 flex items-center text-sm text-${originalExp.color}-700">
                                    <i class="fas fa-robot mr-2"></i>
                                    <span>ç”±AIæ™ºèƒ½ç”Ÿæˆçš„ä¸ªæ€§åŒ–å®éªŒå†…å®¹</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- å®éªŒç›®æ ‡ -->
                    <div>
                        <h4 class="text-lg font-semibold text-gray-900 mb-3">
                            <i class="fas fa-bullseye text-blue-600 mr-2"></i>
                            å®éªŒç›®æ ‡
                        </h4>
                        <ul class="space-y-2">
                            ${(experimentData.objectives || []).map(obj => `
                                <li class="flex items-start">
                                    <i class="fas fa-check-circle text-green-500 mt-1 mr-3"></i>
                                    <span class="text-gray-700">${obj}</span>
                                </li>
                            `).join('')}
                        </ul>
                    </div>

                    <!-- ç†è®ºåŸºç¡€ -->
                    <div>
                        <h4 class="text-lg font-semibold text-gray-900 mb-3">
                            <i class="fas fa-book text-purple-600 mr-2"></i>
                            ç†è®ºåŸºç¡€
                        </h4>
                        <div class="bg-gray-50 rounded-lg p-4">
                            <p class="text-gray-700">${experimentData.theory || 'ç›¸å…³ç†è®ºçŸ¥è¯†å°†åœ¨å®éªŒè¿‡ç¨‹ä¸­è¯¦ç»†ä»‹ç»'}</p>
                        </div>
                    </div>

                    <!-- å®éªŒæ­¥éª¤ -->
                    <div>
                        <h4 class="text-lg font-semibold text-gray-900 mb-3">
                            <i class="fas fa-list-ol text-orange-600 mr-2"></i>
                            å®éªŒæ­¥éª¤
                        </h4>
                        <ol class="space-y-3">
                            ${(experimentData.steps || []).map((step, index) => `
                                <li class="flex items-start">
                                    <div class="flex-shrink-0 w-8 h-8 bg-${originalExp.color}-500 text-white rounded-full flex items-center justify-center text-sm font-medium mr-3">
                                        ${index + 1}
                                    </div>
                                    <span class="text-gray-700 pt-1">${step}</span>
                                </li>
                            `).join('')}
                        </ol>
                    </div>

                    <!-- åœ¨çº¿ä»¿çœŸç•Œé¢ -->
                    <div>
                        <h4 class="text-lg font-semibold text-gray-900 mb-3">
                            <i class="fas fa-desktop text-green-600 mr-2"></i>
                            åœ¨çº¿ä»¿çœŸç•Œé¢
                        </h4>
                        <div class="bg-gray-900 rounded-lg p-6 text-center">
                            <div class="bg-gray-800 rounded-lg p-8 mb-4">
                                <i class="fas fa-play-circle text-4xl text-green-400 mb-4"></i>
                                <h5 class="text-white text-lg font-medium mb-2">äº¤äº’å¼ä»¿çœŸç¯å¢ƒ</h5>
                                <p class="text-gray-300 text-sm mb-4">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¯åŠ¨ä¸“ä¸ºæ­¤å®éªŒå®šåˆ¶çš„ä»¿çœŸç¯å¢ƒ</p>
                                ${experimentData.simulation_url ? `
                                    <iframe src="${experimentData.simulation_url}" 
                                            class="w-full h-64 rounded-lg border-2 border-gray-600 mb-4"
                                            frameborder="0">
                                    </iframe>
                                ` : `
                                    <div class="bg-gray-700 rounded-lg p-6 mb-4">
                                        <i class="fas fa-cogs text-2xl text-blue-400 mb-2"></i>
                                        <p class="text-gray-300 text-sm">ä»¿çœŸç¯å¢ƒæ­£åœ¨å‡†å¤‡ä¸­...</p>
                                    </div>
                                `}
                            </div>
                            <button class="bg-${originalExp.color}-600 hover:bg-${originalExp.color}-700 text-white px-6 py-3 rounded-lg font-medium transition-colors" 
                                    onclick="startSimulation('${originalExp.id}')">
                                <i class="fas fa-rocket mr-2"></i>
                                å¯åŠ¨ä»¿çœŸå®éªŒ
                            </button>
                        </div>
                    </div>

                    <!-- é¢„æœŸç»“æœ -->
                    <div>
                        <h4 class="text-lg font-semibold text-gray-900 mb-3">
                            <i class="fas fa-chart-line text-indigo-600 mr-2"></i>
                            é¢„æœŸç»“æœ
                        </h4>
                        <div class="bg-blue-50 rounded-lg p-4">
                            <p class="text-gray-700">${experimentData.expected_results || 'é€šè¿‡æœ¬å®éªŒï¼Œæ‚¨å°†è·å¾—å¯¹ç›¸å…³ç†è®ºçš„æ·±å…¥ç†è§£å’Œå®è·µç»éªŒ'}</p>
                        </div>
                    </div>

                    <!-- AIåŠ©æ‰‹å»ºè®® -->
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-6">
                        <h4 class="text-lg font-semibold text-blue-900 mb-3">
                            <i class="fas fa-robot mr-2"></i>
                            AIåŠ©æ‰‹å»ºè®®
                        </h4>
                        <div class="space-y-2 text-blue-800">
                            <p>â€¢ å®éªŒå‰è¯·ä»”ç»†é˜…è¯»å®éªŒç›®æ ‡å’Œç†è®ºåŸºç¡€</p>
                            <p>â€¢ æŒ‰ç…§æ­¥éª¤é€æ­¥è¿›è¡Œï¼Œæ³¨æ„è§‚å¯Ÿå®éªŒç°è±¡</p>
                            <p>â€¢ å¦‚æœ‰ç–‘é—®ï¼Œå¯éšæ—¶ç‚¹å‡»AIåŠ©æ‰‹è·å–å¸®åŠ©</p>
                            <p>â€¢ å®éªŒå®Œæˆåï¼Œè¯·è®¤çœŸåˆ†æç»“æœå¹¶æ€»ç»“ç»éªŒ</p>
                        </div>
                    </div>
                </div>
            `;
        }

        // æ˜¾ç¤ºå¤‡ç”¨å®éªŒå†…å®¹
        function displayFallbackExperiment(experiment) {
            const content = document.getElementById('modalContent');

            content.innerHTML = `
                <div class="space-y-6">
                    <!-- å®éªŒæ¦‚è§ˆ -->
                    <div class="bg-gradient-to-r from-${experiment.color}-50 to-${experiment.color}-100 rounded-lg p-6">
                        <div class="flex items-start">
                            <div class="p-3 bg-${experiment.color}-200 rounded-lg mr-4">
                                <i class="${experiment.icon} text-${experiment.color}-700 text-2xl"></i>
                            </div>
                            <div class="flex-1">
                                <h4 class="text-lg font-semibold text-gray-900 mb-2">å®éªŒæ¦‚è§ˆ</h4>
                                <p class="text-gray-700">${experiment.description}</p>
                                <div class="mt-4 flex items-center text-sm text-${experiment.color}-700">
                                    <i class="fas fa-exclamation-circle mr-2"></i>
                                    <span>AIç”ŸæˆæœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œæ˜¾ç¤ºåŸºç¡€å®éªŒå†…å®¹</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- åŸºç¡€ä¿¡æ¯ -->
                    <div>
                        <h4 class="text-lg font-semibold text-gray-900 mb-3">
                            <i class="fas fa-info-circle text-blue-600 mr-2"></i>
                            å®éªŒä¿¡æ¯
                        </h4>
                        <div class="bg-gray-50 rounded-lg p-4">
                            <p class="text-gray-700 mb-4">è¿™æ˜¯ä¸€ä¸ªå…³äº${experiment.title}çš„å®éªŒã€‚</p>
                            <p class="text-gray-700">AIåŠ©æ‰‹å°†åœ¨æœåŠ¡æ¢å¤åä¸ºæ‚¨ç”Ÿæˆè¯¦ç»†çš„å®éªŒå†…å®¹ï¼ŒåŒ…æ‹¬ï¼š</p>
                            <ul class="mt-2 space-y-1 text-gray-600">
                                <li>â€¢ è¯¦ç»†çš„å®éªŒç›®æ ‡å’Œç†è®ºåŸºç¡€</li>
                                <li>â€¢ é€æ­¥çš„å®éªŒæ“ä½œæŒ‡å¯¼</li>
                                <li>â€¢ äº¤äº’å¼åœ¨çº¿ä»¿çœŸç¯å¢ƒ</li>
                                <li>â€¢ ä¸ªæ€§åŒ–çš„å­¦ä¹ å»ºè®®</li>
                            </ul>
                        </div>
                    </div>

                    <!-- é‡è¯•æŒ‰é’® -->
                    <div class="text-center">
                        <button onclick="generateExperiment({id: '${experiment.id}', title: '${experiment.title}', description: '${experiment.description}', subject: '${experiment.subject}', icon: '${experiment.icon}', color: '${experiment.color}'})" 
                                class="bg-${experiment.color}-600 hover:bg-${experiment.color}-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                            <i class="fas fa-redo mr-2"></i>
                            é‡æ–°ç”Ÿæˆå®éªŒå†…å®¹
                        </button>
                    </div>
                </div>
            `;
        }

        // å¯åŠ¨ä»¿çœŸå®éªŒ
        function startSimulation(experimentId) {
            // è·å–ä»¿çœŸURL
            const simulationUrls = {
                'circuit_ohm': '/static/simulations/circuit-simulator.html',
                'circuit_rc': '/static/simulations/general-simulator.html',
                'digital_gates': '/static/simulations/general-simulator.html',
                'analog_opamp': '/static/simulations/general-simulator.html',
                'signal_fourier': '/static/simulations/general-simulator.html',
                'comm_am': '/static/simulations/general-simulator.html',
                'embedded_gpio': '/static/simulations/general-simulator.html'
            };

            const simulationUrl = simulationUrls[experimentId] || '/static/simulations/general-simulator.html';

            // åœ¨æ–°çª—å£ä¸­æ‰“å¼€ä»¿çœŸç¯å¢ƒ
            window.open(simulationUrl, '_blank', 'width=1200,height=800,scrollbars=yes,resizable=yes');
        }

        // å­¦ç§‘æ ‡ç­¾é¡µåˆ‡æ¢
        function initSubjectTabs() {
            const tabs = document.querySelectorAll('.subject-tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
                    tabs.forEach(t => t.classList.remove('active'));
                    // æ·»åŠ å½“å‰æ´»åŠ¨çŠ¶æ€
                    tab.classList.add('active');

                    const subject = tab.dataset.subject;
                    if (subject === 'all') {
                        renderExperiments(getAllExperiments());
                    } else {
                        renderExperiments(experimentModules[subject] || []);
                    }
                });
            });
        }

        // AIåŠ©æ‰‹åŠŸèƒ½
        function initAIAssistant() {
            const aiBtn = document.getElementById('aiAssistantBtn');
            const chatWindow = document.getElementById('aiChatWindow');
            const closeBtn = document.getElementById('closeChatBtn');
            const sendBtn = document.getElementById('sendChatBtn');
            const chatInput = document.getElementById('chatInput');
            const chatMessages = document.getElementById('chatMessages');

            aiBtn.addEventListener('click', () => {
                chatWindow.classList.toggle('hidden');
            });

            closeBtn.addEventListener('click', () => {
                chatWindow.classList.add('hidden');
            });

            function sendMessage() {
                const message = chatInput.value.trim();
                if (!message) return;

                // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
                const userMsg = document.createElement('div');
                userMsg.className = 'bg-gray-100 rounded-lg p-3 ml-8';
                userMsg.innerHTML = `<p class="text-sm text-gray-800">${message}</p>`;
                chatMessages.appendChild(userMsg);

                // æ¸…ç©ºè¾“å…¥æ¡†
                chatInput.value = '';

                // æ¨¡æ‹ŸAIå›å¤
                setTimeout(() => {
                    const aiMsg = document.createElement('div');
                    aiMsg.className = 'bg-blue-100 rounded-lg p-3';
                    aiMsg.innerHTML = `<p class="text-sm text-blue-800">ğŸ¤– å…³äº"${message}"çš„é—®é¢˜ï¼Œæˆ‘å»ºè®®ä½ æŸ¥çœ‹ç›¸å…³å®éªŒçš„ç†è®ºåŸºç¡€ï¼Œæˆ–è€…å‚è€ƒå®éªŒæ­¥éª¤ä¸­çš„è¯¦ç»†è¯´æ˜ã€‚å¦‚éœ€æ›´å…·ä½“çš„å¸®åŠ©ï¼Œè¯·æè¿°ä½ é‡åˆ°çš„å…·ä½“é—®é¢˜ã€‚</p>`;
                    chatMessages.appendChild(aiMsg);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }, 1000);

                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            sendBtn.addEventListener('click', sendMessage);
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
        }

        // æ¨¡æ€æ¡†æ§åˆ¶
        function initModal() {
            const modal = document.getElementById('experimentModal');
            const closeBtn = document.getElementById('closeModal');

            closeBtn.addEventListener('click', () => {
                modal.classList.add('hidden');
            });

            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.add('hidden');
                }
            });
        }

        // ç”¨æˆ·èœå•
        function initUserMenu() {
            const userMenuBtn = document.getElementById('userMenuBtn');
            const userMenu = document.getElementById('userMenu');

            userMenuBtn.addEventListener('click', () => {
                userMenu.classList.toggle('hidden');
            });

            document.addEventListener('click', (e) => {
                if (!userMenuBtn.contains(e.target)) {
                    userMenu.classList.add('hidden');
                }
            });
        }

        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            renderExperiments(getAllExperiments());
            initSubjectTabs();
            initAIAssistant();
            initModal();
            initUserMenu();
        });
    </script>
    <!-- Global Theme Manager -->
    <script src="/static/js/global-theme.js"></script>
</body>

</html>