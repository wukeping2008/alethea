<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WiFi智能感知项目 - Alethea</title>
    <!-- Tailwind CSS -->
    <link rel="stylesheet" href="/static/libs/css/tailwind.min.css">
    <!-- Global Theme CSS -->
    <link rel="stylesheet" href="/static/css/global-theme.css">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js for data visualization -->
    <script src="/static/libs/js/chart.min.js"></script>
    <!-- Monaco Editor for code editing -->
    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.44.0/min/vs/loader.js"></script>
    <!-- Custom styles -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap');

        :root {
            --primary-color: #0a2342;
            --secondary-color: #126872;
            --accent-color: #2ca58d;
            --light-color: #f8f9fa;
            --dark-color: #212529;
        }

        body {
            font-family: 'Noto Sans SC', sans-serif;
            background-color: #f5f7fa;
        }

        .stage-card {
            border-radius: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid #e2e8f0;
        }

        .stage-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
            border-color: var(--accent-color);
        }

        .stage-card.active {
            border-color: var(--accent-color);
            background: linear-gradient(135deg, #f0fdfa, #ecfdf5);
        }

        .stage-card.completed {
            border-color: #10b981;
            background: linear-gradient(135deg, #ecfdf5, #d1fae5);
        }

        .progress-bar {
            height: 8px;
            border-radius: 4px;
            background: #e5e7eb;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-color), #22d3ee);
            transition: width 0.5s ease;
        }

        .code-editor {
            height: 400px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
        }

        .ai-assistant {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #8b5cf6, #a855f7);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .ai-assistant:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
        }

        .ai-chat-panel {
            position: fixed;
            bottom: 100px;
            right: 20px;
            width: 350px;
            height: 500px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            display: none;
            flex-direction: column;
            z-index: 1001;
        }

        .ai-chat-header {
            background: linear-gradient(135deg, #8b5cf6, #a855f7);
            color: white;
            padding: 16px;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: between;
            align-items: center;
        }

        .ai-chat-messages {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
            max-height: 350px;
        }

        .ai-chat-input {
            padding: 16px;
            border-top: 1px solid #e5e7eb;
            border-radius: 0 0 12px 12px;
        }

        .message {
            margin-bottom: 12px;
            padding: 8px 12px;
            border-radius: 8px;
            max-width: 80%;
        }

        .message.user {
            background: #e0e7ff;
            margin-left: auto;
            text-align: right;
        }

        .message.ai {
            background: #f3f4f6;
            margin-right: auto;
        }

        .stage-content {
            display: none;
        }

        .stage-content.active {
            display: block;
        }

        .skill-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            background: #e0e7ff;
            color: #3730a3;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            margin: 2px;
        }

        .csi-animation {
            width: 100%;
            height: 300px;
            background: linear-gradient(135deg, #1e293b, #334155);
            border-radius: 12px;
            position: relative;
            overflow: hidden;
        }

        .wifi-device {
            position: absolute;
            width: 60px;
            height: 60px;
            background: #3b82f6;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
        }

        .wifi-wave {
            position: absolute;
            border: 2px solid #60a5fa;
            border-radius: 50%;
            animation: waveExpand 2s infinite;
        }

        @keyframes waveExpand {
            0% {
                width: 60px;
                height: 60px;
                opacity: 1;
            }

            100% {
                width: 200px;
                height: 200px;
                opacity: 0;
            }
        }

        .person-icon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            color: #f59e0b;
            animation: personMove 4s infinite;
        }

        @keyframes personMove {

            0%,
            100% {
                transform: translate(-50%, -50%) translateX(-20px);
            }

            50% {
                transform: translate(-50%, -50%) translateX(20px);
            }
        }
    </style>
</head>

<body>
    <!-- Navigation -->
    <nav class="bg-white shadow-sm py-4">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <div class="flex items-center">
                <img src="/static/logo.png" alt="Alethea Logo" class="h-10 mr-3">
                <span class="text-2xl font-bold text-primary">Alethea</span>
            </div>
            <div class="flex items-center space-x-4">
                <a href="/static/projects.html" class="text-gray-600 hover:text-primary">
                    <i class="fas fa-arrow-left mr-2"></i>返回项目列表
                </a>
                <div class="relative" id="user-menu">
                    <button class="flex items-center space-x-2 focus:outline-none">
                        <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center">
                            <i class="fas fa-user text-gray-600"></i>
                        </div>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Project Header -->
    <section class="bg-gradient-to-r from-blue-600 to-teal-600 text-white py-12">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-4xl font-bold mb-4">WiFi智能感知项目</h1>
                    <p class="text-xl mb-4">基于WiFi CSI信号的人体存在检测系统</p>
                    <div class="flex items-center space-x-6">
                        <span class="flex items-center">
                            <i class="fas fa-clock mr-2"></i>3-4周
                        </span>
                        <span class="flex items-center">
                            <i class="fas fa-signal mr-2"></i>中级难度
                        </span>
                        <span class="flex items-center">
                            <i class="fas fa-code mr-2"></i>AI编程辅助
                        </span>
                    </div>
                </div>
                <div class="text-right">
                    <div class="text-sm mb-2">项目进度</div>
                    <div class="progress-bar w-48 mb-2">
                        <div class="progress-fill" id="overall-progress" style="width: 0%"></div>
                    </div>
                    <div class="text-sm" id="progress-text">0% 完成</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Project Stages -->
    <section class="container mx-auto px-4 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-8">
            <!-- Stage Navigation -->
            <div class="lg:col-span-1">
                <h3 class="text-xl font-bold mb-4">学习阶段</h3>
                <div class="space-y-3">
                    <div class="stage-card bg-white p-4 active" data-stage="0" onclick="switchStage(0)">
                        <div class="flex items-center justify-between mb-2">
                            <h4 class="font-semibold">阶段1：理论学习</h4>
                            <i class="fas fa-book text-blue-500"></i>
                        </div>
                        <p class="text-sm text-gray-600">CSI信号原理与AIoT架构</p>
                        <div class="progress-bar mt-2">
                            <div class="progress-fill" style="width: 0%"></div>
                        </div>
                    </div>

                    <div class="stage-card bg-white p-4" data-stage="1" onclick="switchStage(1)">
                        <div class="flex items-center justify-between mb-2">
                            <h4 class="font-semibold">阶段2：数据采集</h4>
                            <i class="fas fa-database text-green-500"></i>
                        </div>
                        <p class="text-sm text-gray-600">ESP32数据采集与接口编程</p>
                        <div class="progress-bar mt-2">
                            <div class="progress-fill" style="width: 0%"></div>
                        </div>
                    </div>

                    <div class="stage-card bg-white p-4" data-stage="2" onclick="switchStage(2)">
                        <div class="flex items-center justify-between mb-2">
                            <h4 class="font-semibold">阶段3：信号处理</h4>
                            <i class="fas fa-wave-square text-purple-500"></i>
                        </div>
                        <p class="text-sm text-gray-600">信号滤波与特征提取</p>
                        <div class="progress-bar mt-2">
                            <div class="progress-fill" style="width: 0%"></div>
                        </div>
                    </div>

                    <div class="stage-card bg-white p-4" data-stage="3" onclick="switchStage(3)">
                        <div class="flex items-center justify-between mb-2">
                            <h4 class="font-semibold">阶段4：模型训练</h4>
                            <i class="fas fa-brain text-red-500"></i>
                        </div>
                        <p class="text-sm text-gray-600">机器学习模型训练与优化</p>
                        <div class="progress-bar mt-2">
                            <div class="progress-fill" style="width: 0%"></div>
                        </div>
                    </div>

                    <div class="stage-card bg-white p-4" data-stage="4" onclick="switchStage(4)">
                        <div class="flex items-center justify-between mb-2">
                            <h4 class="font-semibold">阶段5：云端部署</h4>
                            <i class="fas fa-cloud text-indigo-500"></i>
                        </div>
                        <p class="text-sm text-gray-600">ECS部署与系统集成</p>
                        <div class="progress-bar mt-2">
                            <div class="progress-fill" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stage Content -->
            <div class="lg:col-span-3">
                <!-- Stage 0: Theory Learning -->
                <div class="stage-content active" id="stage-0">
                    <div class="bg-white rounded-lg p-6 shadow-lg">
                        <h3 class="text-2xl font-bold mb-4">阶段1：理论学习</h3>

                        <!-- CSI Animation -->
                        <div class="mb-6">
                            <h4 class="text-lg font-semibold mb-3">CSI信号原理演示</h4>
                            <div class="csi-animation">
                                <div class="wifi-device" style="top: 50%; left: 20%;">
                                    <i class="fas fa-wifi"></i>
                                    <div class="wifi-wave"
                                        style="top: 50%; left: 50%; transform: translate(-50%, -50%);"></div>
                                </div>
                                <div class="wifi-device" style="top: 50%; right: 20%;">
                                    <i class="fas fa-wifi"></i>
                                </div>
                                <div class="person-icon">
                                    <i class="fas fa-walking"></i>
                                </div>
                            </div>
                            <p class="text-sm text-gray-600 mt-2">
                                当人体经过WiFi设备之间时，会改变信道状态信息(CSI)，通过分析这些变化可以检测人体存在。
                            </p>
                        </div>

                        <!-- Learning Content -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div class="border rounded-lg p-4">
                                <h5 class="font-semibold mb-3">
                                    <i class="fas fa-signal mr-2 text-blue-500"></i>CSI信号特征
                                </h5>
                                <ul class="space-y-2 text-sm">
                                    <li><strong>振幅：</strong>信号强度的变化</li>
                                    <li><strong>相位：</strong>信号波形的偏移</li>
                                    <li><strong>功率：</strong>信号的能量度量</li>
                                    <li><strong>DFS：</strong>动态频率选择</li>
                                </ul>
                            </div>
                            <div class="border rounded-lg p-4">
                                <h5 class="font-semibold mb-3">
                                    <i class="fas fa-network-wired mr-2 text-green-500"></i>AIoT架构
                                </h5>
                                <ul class="space-y-2 text-sm">
                                    <li><strong>感知层：</strong>ESP32设备采集</li>
                                    <li><strong>网络层：</strong>WiFi数据传输</li>
                                    <li><strong>平台层：</strong>云端数据处理</li>
                                    <li><strong>应用层：</strong>智能决策系统</li>
                                </ul>
                            </div>
                        </div>

                        <!-- Skills Required -->
                        <div class="mb-6">
                            <h5 class="font-semibold mb-3">本阶段技能要求</h5>
                            <div class="flex flex-wrap">
                                <span class="skill-badge">信号处理基础</span>
                                <span class="skill-badge">WiFi通信原理</span>
                                <span class="skill-badge">物联网架构</span>
                                <span class="skill-badge">Python基础</span>
                            </div>
                        </div>

                        <!-- Interactive Quiz -->
                        <div class="bg-blue-50 rounded-lg p-4 mb-6">
                            <h5 class="font-semibold mb-3">
                                <i class="fas fa-question-circle mr-2"></i>知识检测
                            </h5>
                            <div id="quiz-container">
                                <p class="mb-3">CSI信号中哪个参数最能反映人体移动？</p>
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="radio" name="quiz1" value="amplitude" class="mr-2">
                                        振幅变化
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="quiz1" value="phase" class="mr-2">
                                        相位变化
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="quiz1" value="power" class="mr-2">
                                        功率变化
                                    </label>
                                </div>
                                <button onclick="checkQuiz()"
                                    class="mt-3 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                                    提交答案
                                </button>
                                <div id="quiz-result" class="mt-3 hidden"></div>
                            </div>
                        </div>

                        <!-- Stage Actions -->
                        <div class="flex justify-between">
                            <button class="bg-gray-300 text-gray-700 px-6 py-2 rounded" disabled>
                                <i class="fas fa-arrow-left mr-2"></i>上一阶段
                            </button>
                            <button onclick="completeStage(0)"
                                class="bg-green-500 text-white px-6 py-2 rounded hover:bg-green-600">
                                完成阶段 <i class="fas fa-arrow-right ml-2"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Stage 1: Data Collection -->
                <div class="stage-content" id="stage-1">
                    <div class="bg-white rounded-lg p-6 shadow-lg">
                        <h3 class="text-2xl font-bold mb-4">阶段2：数据采集</h3>

                        <!-- Data Collection Interface -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                            <div class="border rounded-lg p-4">
                                <h5 class="font-semibold mb-3">
                                    <i class="fas fa-microchip mr-2 text-blue-500"></i>ESP32接口配置
                                </h5>
                                <div class="code-editor" id="esp32-config-editor"></div>
                                <button onclick="testESP32Connection()"
                                    class="mt-3 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                                    <i class="fas fa-plug mr-2"></i>测试连接
                                </button>
                            </div>
                            <div class="border rounded-lg p-4">
                                <h5 class="font-semibold mb-3">
                                    <i class="fas fa-chart-line mr-2 text-green-500"></i>实时数据监控
                                </h5>
                                <canvas id="csi-chart" width="400" height="200"></canvas>
                                <div class="flex space-x-2 mt-3">
                                    <button onclick="startDataCollection()"
                                        class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                                        <i class="fas fa-play mr-2"></i>开始采集
                                    </button>
                                    <button onclick="stopDataCollection()"
                                        class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
                                        <i class="fas fa-stop mr-2"></i>停止采集
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Data Format -->
                        <div class="mb-6">
                            <h5 class="font-semibold mb-3">CSI数据格式</h5>
                            <div class="bg-gray-100 rounded-lg p-4">
                                <pre class="text-sm"><code>{
  "timestamp": "2025-06-13T22:00:00Z",
  "device_id": "esp32_001",
  "csi_data": {
    "amplitude": [array_of_30_subcarriers],
    "phase": [array_of_30_subcarriers],
    "rssi": -45,
    "channel": 6,
    "bandwidth": 20
  },
  "label": 1,  // 0: 无人, 1: 有人
  "metadata": {
    "sampling_rate": 100,
    "duration": 10,
    "environment": "classroom"
  }
}</code></pre>
                            </div>
                        </div>

                        <!-- Programming Exercise -->
                        <div class="bg-purple-50 rounded-lg p-4 mb-6">
                            <h5 class="font-semibold mb-3">
                                <i class="fas fa-code mr-2"></i>编程练习：数据采集脚本
                            </h5>
                            <p class="text-sm text-gray-600 mb-3">编写Python脚本从ESP32设备采集CSI数据</p>
                            <div class="code-editor" id="data-collection-editor"></div>
                            <div class="flex space-x-2 mt-3">
                                <button onclick="runCode('data-collection')"
                                    class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                                    <i class="fas fa-play mr-2"></i>运行代码
                                </button>
                                <button onclick="getAIHelp('data-collection')"
                                    class="bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600">
                                    <i class="fas fa-robot mr-2"></i>AI助手
                                </button>
                            </div>
                            <div id="code-output" class="mt-3 p-3 bg-black text-green-400 rounded text-sm hidden"></div>
                        </div>

                        <!-- Stage Actions -->
                        <div class="flex justify-between">
                            <button onclick="switchStage(0)"
                                class="bg-gray-300 text-gray-700 px-6 py-2 rounded hover:bg-gray-400">
                                <i class="fas fa-arrow-left mr-2"></i>上一阶段
                            </button>
                            <button onclick="completeStage(1)"
                                class="bg-green-500 text-white px-6 py-2 rounded hover:bg-green-600">
                                完成阶段 <i class="fas fa-arrow-right ml-2"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Stage 2: Signal Processing -->
                <div class="stage-content" id="stage-2">
                    <div class="bg-white rounded-lg p-6 shadow-lg">
                        <h3 class="text-2xl font-bold mb-4">阶段3：信号处理</h3>

                        <!-- Signal Processing Methods -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div class="border rounded-lg p-4">
                                <h5 class="font-semibold mb-3">
                                    <i class="fas fa-filter mr-2 text-blue-500"></i>滤波算法选择
                                </h5>
                                <div class="space-y-3">
                                    <label class="flex items-center">
                                        <input type="radio" name="filter" value="mean" class="mr-2" checked>
                                        均值滤波
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="filter" value="median" class="mr-2">
                                        中值滤波
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="filter" value="fft" class="mr-2">
                                        FFT变换
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="filter" value="wavelet" class="mr-2">
                                        小波变换
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="filter" value="emd" class="mr-2">
                                        EMD分解
                                    </label>
                                </div>
                                <button onclick="applyFilter()"
                                    class="mt-3 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                                    应用滤波
                                </button>
                            </div>
                            <div class="border rounded-lg p-4">
                                <h5 class="font-semibold mb-3">
                                    <i class="fas fa-chart-area mr-2 text-green-500"></i>信号对比
                                </h5>
                                <canvas id="signal-comparison-chart" width="400" height="200"></canvas>
                                <div class="text-sm text-gray-600 mt-2">
                                    蓝色：原始信号 | 红色：处理后信号
                                </div>
                            </div>
                        </div>

                        <!-- Feature Extraction -->
                        <div class="mb-6">
                            <h5 class="font-semibold mb-3">特征提取</h5>
                            <div class="bg-gray-100 rounded-lg p-4">
                                <div class="code-editor" id="feature-extraction-editor"></div>
                                <div class="flex space-x-2 mt-3">
                                    <button onclick="extractFeatures()"
                                        class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                                        <i class="fas fa-cogs mr-2"></i>提取特征
                                    </button>
                                    <button onclick="getAIHelp('feature-extraction')"
                                        class="bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600">
                                        <i class="fas fa-robot mr-2"></i>AI助手
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Stage Actions -->
                        <div class="flex justify-between">
                            <button onclick="switchStage(1)"
                                class="bg-gray-300 text-gray-700 px-6 py-2 rounded hover:bg-gray-400">
                                <i class="fas fa-arrow-left mr-2"></i>上一阶段
                            </button>
                            <button onclick="completeStage(2)"
                                class="bg-green-500 text-white px-6 py-2 rounded hover:bg-green-600">
                                完成阶段 <i class="fas fa-arrow-right ml-2"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Stage 3: Model Training -->
                <div class="stage-content" id="stage-3">
                    <div class="bg-white rounded-lg p-6 shadow-lg">
                        <h3 class="text-2xl font-bold mb-4">阶段4：模型训练</h3>

                        <!-- Model Selection -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                            <div class="border rounded-lg p-4">
                                <h5 class="font-semibold mb-3">
                                    <i class="fas fa-brain mr-2 text-purple-500"></i>模型选择
                                </h5>
                                <select id="model-select" class="w-full p-2 border rounded mb-3">
                                    <option value="gru">GRU (门控循环单元)</option>
                                    <option value="lstm">LSTM (长短期记忆网络)</option>
                                    <option value="bilstm">BiLSTM (双向LSTM)</option>
                                    <option value="resnet18">ResNet18 (残差网络)</option>
                                    <option value="resnet34">ResNet34</option>
                                    <option value="resnet50">ResNet50</option>
                                    <option value="lp_rnn">LP_RNN (轻量化RNN)</option>
                                </select>
                                <button onclick="trainModel()"
                                    class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600 w-full">
                                    <i class="fas fa-play mr-2"></i>开始训练
                                </button>
                            </div>
                            <div class="border rounded-lg p-4">
                                <h5 class="font-semibold mb-3">
                                    <i class="fas fa-chart-line mr-2 text-green-500"></i>训练监控
                                </h5>
                                <canvas id="training-chart" width="400" height="200"></canvas>
                                <div class="mt-3 grid grid-cols-2 gap-4 text-sm">
                                    <div class="text-center">
                                        <div class="font-semibold">训练准确率</div>
                                        <div id="train-accuracy" class="text-lg text-green-600">0%</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="font-semibold">验证准确率</div>
                                        <div id="val-accuracy" class="text-lg text-blue-600">0%</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Model Code -->
                        <div class="mb-6">
                            <h5 class="font-semibold mb-3">模型训练代码</h5>
                            <div class="code-editor" id="model-training-editor"></div>
                            <div class="flex space-x-2 mt-3">
                                <button onclick="runCode('model-training')"
                                    class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                                    <i class="fas fa-play mr-2"></i>运行训练
                                </button>
                                <button onclick="getAIHelp('model-training')"
                                    class="bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600">
                                    <i class="fas fa-robot mr-2"></i>AI助手
                                </button>
                            </div>
                        </div>

                        <!-- Stage Actions -->
                        <div class="flex justify-between">
                            <button onclick="switchStage(2)"
                                class="bg-gray-300 text-gray-700 px-6 py-2 rounded hover:bg-gray-400">
                                <i class="fas fa-arrow-left mr-2"></i>上一阶段
                            </button>
                            <button onclick="completeStage(3)"
                                class="bg-green-500 text-white px-6 py-2 rounded hover:bg-green-600">
                                完成阶段 <i class="fas fa-arrow-right ml-2"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Stage 4: Cloud Deployment -->
                <div class="stage-content" id="stage-4">
                    <div class="bg-white rounded-lg p-6 shadow-lg">
                        <h3 class="text-2xl font-bold mb-4">阶段5：云端部署</h3>

                        <!-- Deployment Guide -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                            <div class="border rounded-lg p-4">
                                <h5 class="font-semibold mb-3">
                                    <i class="fas fa-cloud mr-2 text-blue-500"></i>ECS部署指导
                                </h5>
                                <div class="space-y-3 text-sm">
                                    <div class="flex items-start">
                                        <span
                                            class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs mr-2 mt-0.5">1</span>
                                        <span>创建ECS实例，选择Ubuntu 22.04 LTS</span>
                                    </div>
                                    <div class="flex items-start">
                                        <span
                                            class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs mr-2 mt-0.5">2</span>
                                        <span>配置安全组，开放8080端口</span>
                                    </div>
                                    <div class="flex items-start">
                                        <span
                                            class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs mr-2 mt-0.5">3</span>
                                        <span>安装Python环境和依赖包</span>
                                    </div>
                                    <div class="flex items-start">
                                        <span
                                            class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs mr-2 mt-0.5">4</span>
                                        <span>部署Flask应用和模型文件</span>
                                    </div>
                                    <div class="flex items-start">
                                        <span
                                            class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs mr-2 mt-0.5">5</span>
                                        <span>配置Nginx反向代理</span>
                                    </div>
                                </div>
                            </div>
                            <div class="border rounded-lg p-4">
                                <h5 class="font-semibold mb-3">
                                    <i class="fas fa-server mr-2 text-green-500"></i>系统架构
                                </h5>
                                <div class="bg-gray-50 p-4 rounded text-center">
                                    <div class="space-y-2">
                                        <div class="bg-blue-100 p-2 rounded">ESP32设备</div>
                                        <div class="text-gray-400">↓ WiFi</div>
                                        <div class="bg-green-100 p-2 rounded">ECS服务器</div>
                                        <div class="text-gray-400">↓ HTTP API</div>
                                        <div class="bg-purple-100 p-2 rounded">Web应用</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Deployment Code -->
                        <div class="mb-6">
                            <h5 class="font-semibold mb-3">部署脚本</h5>
                            <div class="code-editor" id="deployment-editor"></div>
                            <div class="flex space-x-2 mt-3">
                                <button onclick="generateDeploymentScript()"
                                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                                    <i class="fas fa-file-code mr-2"></i>生成脚本
                                </button>
                                <button onclick="getAIHelp('deployment')"
                                    class="bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600">
                                    <i class="fas fa-robot mr-2"></i>AI助手
                                </button>
                            </div>
                        </div>

                        <!-- Project Summary -->
                        <div class="bg-green-50 rounded-lg p-4 mb-6">
                            <h5 class="font-semibold mb-3">
                                <i class="fas fa-trophy mr-2"></i>项目总结
                            </h5>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                                <div class="text-center">
                                    <div class="font-semibold">掌握技能</div>
                                    <div id="skills-learned">0</div>
                                </div>
                                <div class="text-center">
                                    <div class="font-semibold">代码行数</div>
                                    <div id="lines-of-code">0</div>
                                </div>
                                <div class="text-center">
                                    <div class="font-semibold">学习时长</div>
                                    <div id="study-time">0小时</div>
                                </div>
                            </div>
                        </div>

                        <!-- Stage Actions -->
                        <div class="flex justify-between">
                            <button onclick="switchStage(3)"
                                class="bg-gray-300 text-gray-700 px-6 py-2 rounded hover:bg-gray-400">
                                <i class="fas fa-arrow-left mr-2"></i>上一阶段
                            </button>
                            <button onclick="completeProject()"
                                class="bg-green-500 text-white px-6 py-2 rounded hover:bg-green-600">
                                完成项目 <i class="fas fa-check ml-2"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- AI Assistant -->
    <div class="ai-assistant" onclick="toggleAIChat()" title="AI编程助手">
        <i class="fas fa-robot"></i>
    </div>

    <!-- AI Chat Panel -->
    <div class="ai-chat-panel" id="ai-chat-panel">
        <div class="ai-chat-header">
            <h4 class="font-semibold">AI编程助手</h4>
            <button onclick="toggleAIChat()" class="text-white hover:text-gray-200">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="ai-chat-messages" id="ai-chat-messages">
            <div class="message ai">
                <p>你好！我是你的AI编程助手。我可以帮助你：</p>
                <ul class="text-sm mt-2 space-y-1">
                    <li>• 解释代码和算法</li>
                    <li>• 调试程序错误</li>
                    <li>• 提供编程建议</li>
                    <li>• 生成代码模板</li>
                </ul>
            </div>
        </div>
        <div class="ai-chat-input">
            <div class="flex space-x-2">
                <input type="text" id="ai-input" placeholder="输入你的问题..." class="flex-1 p-2 border rounded"
                    onkeypress="handleAIInput(event)">
                <button onclick="sendAIMessage()"
                    class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // Global variables
        let currentStage = 0;
        let stageProgress = [0, 0, 0, 0, 0];
        let codeEditors = {};
        let charts = {};
        let isDataCollecting = false;
        let trainingInterval = null;

        // Initialize Monaco Editor
        require.config({ paths: { vs: 'https://cdn.jsdelivr.net/npm/monaco-editor@0.44.0/min/vs' } });
        require(['vs/editor/editor.main'], function () {
            initializeCodeEditors();
        });

        // Initialize code editors
        function initializeCodeEditors() {
            // ESP32 Configuration Editor
            codeEditors.esp32Config = monaco.editor.create(document.getElementById('esp32-config-editor'), {
                value: `# ESP32 WiFi CSI 数据采集配置
import wifi
import socket
import json
from machine import Pin

# WiFi配置
WIFI_SSID = "your_wifi_ssid"
WIFI_PASSWORD = "your_wifi_password"
SERVER_HOST = "your_server_ip"
SERVER_PORT = 8080

# CSI配置
CSI_ENABLE = True
CSI_RATE = 100  # 采样率 Hz
SUBCARRIER_COUNT = 30

def setup_wifi():
    """配置WiFi连接"""
    wifi.radio.connect(WIFI_SSID, WIFI_PASSWORD)
    print(f"Connected to {WIFI_SSID}")
    
def setup_csi():
    """配置CSI数据采集"""
    # 启用CSI功能
    # 设置采样参数
    pass`,
                language: 'python',
                theme: 'vs-dark',
                minimap: { enabled: false },
                scrollBeyondLastLine: false
            });

            // Data Collection Editor
            codeEditors.dataCollection = monaco.editor.create(document.getElementById('data-collection-editor'), {
                value: `import requests
import json
import numpy as np
from datetime import datetime
import time

class CSIDataCollector:
    def __init__(self, esp32_ip, server_url):
        self.esp32_ip = esp32_ip
        self.server_url = server_url
        self.is_collecting = False
        
    def collect_csi_data(self, duration=10):
        """从ESP32采集CSI数据"""
        print(f"开始采集CSI数据，持续{duration}秒...")
        
        collected_data = []
        start_time = time.time()
        
        while time.time() - start_time < duration:
            try:
                # 从ESP32获取CSI数据
                response = requests.get(f"http://{self.esp32_ip}/csi")
                if response.status_code == 200:
                    csi_raw = response.json()
                    
                    # 处理CSI数据
                    csi_data = {
                        "timestamp": datetime.now().isoformat(),
                        "device_id": "esp32_001",
                        "csi_data": {
                            "amplitude": csi_raw.get("amplitude", []),
                            "phase": csi_raw.get("phase", []),
                            "rssi": csi_raw.get("rssi", -50),
                            "channel": csi_raw.get("channel", 6),
                            "bandwidth": 20
                        },
                        "label": 0,  # 需要手动标注
                        "metadata": {
                            "sampling_rate": 100,
                            "duration": duration,
                            "environment": "classroom"
                        }
                    }
                    
                    collected_data.append(csi_data)
                    time.sleep(0.01)  # 100Hz采样
                    
            except Exception as e:
                print(f"数据采集错误: {e}")
                
        return collected_data
    
    def save_data(self, data, filename):
        """保存数据到文件"""
        with open(filename, 'w') as f:
            json.dump(data, f, indent=2)
        print(f"数据已保存到 {filename}")

# 使用示例
collector = CSIDataCollector("192.168.1.100", "http://localhost:8080")
data = collector.collect_csi_data(duration=30)
collector.save_data(data, "csi_data.json")`,
                language: 'python',
                theme: 'vs-dark',
                minimap: { enabled: false },
                scrollBeyondLastLine: false
            });

            // Feature Extraction Editor
            codeEditors.featureExtraction = monaco.editor.create(document.getElementById('feature-extraction-editor'), {
                value: `import numpy as np
from scipy import signal
from scipy.fft import fft
import pywt

class CSIFeatureExtractor:
    def __init__(self):
        self.features = {}
        
    def extract_amplitude_features(self, csi_data):
        """提取振幅特征"""
        amplitude = np.array(csi_data['amplitude'])
        
        features = {
            'mean': np.mean(amplitude),
            'std': np.std(amplitude),
            'max': np.max(amplitude),
            'min': np.min(amplitude),
            'range': np.max(amplitude) - np.min(amplitude),
            'variance': np.var(amplitude)
        }
        return features
    
    def extract_phase_features(self, csi_data):
        """提取相位特征"""
        phase = np.array(csi_data['phase'])
        
        # 相位差分
        phase_diff = np.diff(phase)
        
        features = {
            'phase_mean': np.mean(phase),
            'phase_std': np.std(phase),
            'phase_diff_mean': np.mean(phase_diff),
            'phase_diff_std': np.std(phase_diff)
        }
        return features
    
    def apply_filters(self, data, filter_type='median'):
        """应用信号滤波"""
        if filter_type == 'median':
            return signal.medfilt(data, kernel_size=5)
        elif filter_type == 'mean':
            return np.convolve(data, np.ones(5)/5, mode='same')
        elif filter_type == 'fft':
            # FFT滤波
            fft_data = fft(data)
            # 低通滤波
            fft_data[len(fft_data)//4:] = 0
            return np.real(np.fft.ifft(fft_data))
        elif filter_type == 'wavelet':
            # 小波去噪
            coeffs = pywt.wavedec(data, 'db4', level=4)
            threshold = 0.1 * np.max(coeffs[0])
            coeffs_thresh = [pywt.threshold(c, threshold) for c in coeffs]
            return pywt.waverec(coeffs_thresh, 'db4')
        
    def extract_all_features(self, csi_data):
        """提取所有特征"""
        features = {}
        
        # 振幅特征
        amp_features = self.extract_amplitude_features(csi_data)
        features.update({f'amp_{k}': v for k, v in amp_features.items()})
        
        # 相位特征
        phase_features = self.extract_phase_features(csi_data)
        features.update({f'phase_{k}': v for k, v in phase_features.items()})
        
        return features

# 使用示例
extractor = CSIFeatureExtractor()
# 假设有CSI数据
sample_csi = {
    'amplitude': np.random.randn(30),
    'phase': np.random.randn(30)
}
features = extractor.extract_all_features(sample_csi)
print("提取的特征:", features)`,
                language: 'python',
                theme: 'vs-dark',
                minimap: { enabled: false },
                scrollBeyondLastLine: false
            });

            // Model Training Editor
            codeEditors.modelTraining = monaco.editor.create(document.getElementById('model-training-editor'), {
                value: `import torch
import torch.nn as nn
import torch.optim as optim
from torch.utils.data import DataLoader, Dataset
import numpy as np
from sklearn.model_selection import train_test_split
from sklearn.metrics import accuracy_score, confusion_matrix

class CSIDataset(Dataset):
    def __init__(self, features, labels):
        self.features = torch.FloatTensor(features)
        self.labels = torch.LongTensor(labels)
    
    def __len__(self):
        return len(self.features)
    
    def __getitem__(self, idx):
        return self.features[idx], self.labels[idx]

class GRUModel(nn.Module):
    def __init__(self, input_size, hidden_size, num_layers, num_classes):
        super(GRUModel, self).__init__()
        self.hidden_size = hidden_size
        self.num_layers = num_layers
        
        self.gru = nn.GRU(input_size, hidden_size, num_layers, batch_first=True)
        self.fc = nn.Linear(hidden_size, num_classes)
        self.dropout = nn.Dropout(0.2)
        
    def forward(self, x):
        h0 = torch.zeros(self.num_layers, x.size(0), self.hidden_size)
        out, _ = self.gru(x, h0)
        out = self.dropout(out[:, -1, :])
        out = self.fc(out)
        return out

class WiFiSensingTrainer:
    def __init__(self, model_type='gru'):
        self.model_type = model_type
        self.model = None
        self.device = torch.device('cuda' if torch.cuda.is_available() else 'cpu')
        
    def create_model(self, input_size, num_classes=2):
        """创建模型"""
        if self.model_type == 'gru':
            self.model = GRUModel(input_size, 64, 2, num_classes)
        elif self.model_type == 'lstm':
            self.model = nn.LSTM(input_size, 64, 2, batch_first=True)
        # 可以添加更多模型类型
        
        self.model.to(self.device)
        return self.model
    
    def train_model(self, train_loader, val_loader, epochs=50):
        """训练模型"""
        criterion = nn.CrossEntropyLoss()
        optimizer = optim.Adam(self.model.parameters(), lr=0.001)
        
        train_losses = []
        val_accuracies = []
        
        for epoch in range(epochs):
            # 训练阶段
            self.model.train()
            total_loss = 0
            
            for features, labels in train_loader:
                features, labels = features.to(self.device), labels.to(self.device)
                
                optimizer.zero_grad()
                outputs = self.model(features)
                loss = criterion(outputs, labels)
                loss.backward()
                optimizer.step()
                
                total_loss += loss.item()
            
            # 验证阶段
            self.model.eval()
            val_predictions = []
            val_labels = []
            
            with torch.no_grad():
                for features, labels in val_loader:
                    features, labels = features.to(self.device), labels.to(self.device)
                    outputs = self.model(features)
                    _, predicted = torch.max(outputs.data, 1)
                    
                    val_predictions.extend(predicted.cpu().numpy())
                    val_labels.extend(labels.cpu().numpy())
            
            val_acc = accuracy_score(val_labels, val_predictions)
            train_losses.append(total_loss / len(train_loader))
            val_accuracies.append(val_acc)
            
            if epoch % 10 == 0:
                print(f'Epoch [{epoch}/{epochs}], Loss: {total_loss/len(train_loader):.4f}, Val Acc: {val_acc:.4f}')
        
        return train_losses, val_accuracies

# 使用示例
trainer = WiFiSensingTrainer('gru')
model = trainer.create_model(input_size=30)  # 30个子载波
print("模型创建完成，准备训练...")`,
                language: 'python',
                theme: 'vs-dark',
                minimap: { enabled: false },
                scrollBeyondLastLine: false
            });

            // Deployment Editor
            codeEditors.deployment = monaco.editor.create(document.getElementById('deployment-editor'), {
                value: `#!/bin/bash
# WiFi智能感知系统部署脚本

echo "开始部署WiFi智能感知系统..."

# 1. 更新系统
sudo apt update && sudo apt upgrade -y

# 2. 安装Python和依赖
sudo apt install python3 python3-pip python3-venv nginx -y

# 3. 创建项目目录
mkdir -p /opt/wifi-sensing
cd /opt/wifi-sensing

# 4. 创建虚拟环境
python3 -m venv venv
source venv/bin/activate

# 5. 安装Python依赖
pip install flask torch torchvision numpy scipy scikit-learn requests

# 6. 创建Flask应用
cat > app.py << 'EOF'
from flask import Flask, request, jsonify
import torch
import numpy as np
import json

app = Flask(__name__)

# 加载训练好的模型
model = torch.load('wifi_sensing_model.pth', map_location='cpu')
model.eval()

@app.route('/predict', methods=['POST'])
def predict():
    try:
        data = request.json
        csi_data = np.array(data['csi_data'])
        
        # 预处理
        csi_tensor = torch.FloatTensor(csi_data).unsqueeze(0)
        
        # 预测
        with torch.no_grad():
            output = model(csi_tensor)
            prediction = torch.argmax(output, dim=1).item()
        
        result = {
            'prediction': prediction,
            'confidence': torch.softmax(output, dim=1).max().item(),
            'status': 'success'
        }
        
        return jsonify(result)
    
    except Exception as e:
        return jsonify({'error': str(e), 'status': 'error'}), 500

@app.route('/health', methods=['GET'])
def health():
    return jsonify({'status': 'healthy'})

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8080)
EOF

# 7. 配置Nginx
sudo cat > /etc/nginx/sites-available/wifi-sensing << 'EOF'
server {
    listen 80;
    server_name your_domain_or_ip;

    location / {
        proxy_pass http://127.0.0.1:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
EOF

# 8. 启用站点
sudo ln -s /etc/nginx/sites-available/wifi-sensing /etc/nginx/sites-enabled/
sudo nginx -t && sudo systemctl reload nginx

# 9. 创建systemd服务
sudo cat > /etc/systemd/system/wifi-sensing.service << 'EOF'
[Unit]
Description=WiFi Sensing Service
After=network.target

[Service]
Type=simple
User=ubuntu
WorkingDirectory=/opt/wifi-sensing
Environment=PATH=/opt/wifi-sensing/venv/bin
ExecStart=/opt/wifi-sensing/venv/bin/python app.py
Restart=always

[Install]
WantedBy=multi-user.target
EOF

# 10. 启动服务
sudo systemctl daemon-reload
sudo systemctl enable wifi-sensing
sudo systemctl start wifi-sensing

echo "部署完成！"
echo "服务状态: sudo systemctl status wifi-sensing"
echo "访问地址: http://your_server_ip"`,
                language: 'bash',
                theme: 'vs-dark',
                minimap: { enabled: false },
                scrollBeyondLastLine: false
            });
        }

        // Initialize charts
        function initializeCharts() {
            // CSI Data Chart
            const csiCtx = document.getElementById('csi-chart').getContext('2d');
            charts.csiChart = new Chart(csiCtx, {
                type: 'line',
                data: {
                    labels: Array.from({ length: 30 }, (_, i) => `子载波${i + 1}`),
                    datasets: [{
                        label: 'CSI振幅',
                        data: Array.from({ length: 30 }, () => Math.random() * 100),
                        borderColor: 'rgb(59, 130, 246)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Signal Comparison Chart
            const signalCtx = document.getElementById('signal-comparison-chart').getContext('2d');
            charts.signalChart = new Chart(signalCtx, {
                type: 'line',
                data: {
                    labels: Array.from({ length: 100 }, (_, i) => i),
                    datasets: [{
                        label: '原始信号',
                        data: generateSignalData(),
                        borderColor: 'rgb(59, 130, 246)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.1
                    }, {
                        label: '处理后信号',
                        data: generateSignalData(),
                        borderColor: 'rgb(239, 68, 68)',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Training Chart
            const trainingCtx = document.getElementById('training-chart').getContext('2d');
            charts.trainingChart = new Chart(trainingCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: '训练损失',
                        data: [],
                        borderColor: 'rgb(239, 68, 68)',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        tension: 0.1
                    }, {
                        label: '验证准确率',
                        data: [],
                        borderColor: 'rgb(34, 197, 94)',
                        backgroundColor: 'rgba(34, 197, 94, 0.1)',
                        tension: 0.1,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    }
                }
            });
        }

        // Generate signal data
        function generateSignalData() {
            return Array.from({ length: 100 }, (_, i) => {
                return Math.sin(i * 0.1) * 50 + Math.random() * 20 + 50;
            });
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function () {
            initializeCharts();
            updateProgress();
        });

        // Stage switching
        function switchStage(stageIndex) {
            // Update navigation
            document.querySelectorAll('.stage-card').forEach(card => {
                card.classList.remove('active');
            });
            document.querySelector(`[data-stage="${stageIndex}"]`).classList.add('active');

            // Update content
            document.querySelectorAll('.stage-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`stage-${stageIndex}`).classList.add('active');

            currentStage = stageIndex;
        }

        // Complete stage
        function completeStage(stageIndex) {
            stageProgress[stageIndex] = 100;

            // Update stage card
            const stageCard = document.querySelector(`[data-stage="${stageIndex}"]`);
            stageCard.classList.add('completed');
            stageCard.querySelector('.progress-fill').style.width = '100%';

            // Move to next stage
            if (stageIndex < 4) {
                setTimeout(() => {
                    switchStage(stageIndex + 1);
                }, 1000);
            }

            updateProgress();
        }

        // Update overall progress
        function updateProgress() {
            const totalProgress = stageProgress.reduce((a, b) => a + b, 0) / 5;
            document.getElementById('overall-progress').style.width = `${totalProgress}%`;
            document.getElementById('progress-text').textContent = `${Math.round(totalProgress)}% 完成`;
        }

        // Quiz functions
        function checkQuiz() {
            const selected = document.querySelector('input[name="quiz1"]:checked');
            const resultDiv = document.getElementById('quiz-result');

            if (!selected) {
                resultDiv.innerHTML = '<p class="text-red-600">请选择一个答案</p>';
                resultDiv.classList.remove('hidden');
                return;
            }

            if (selected.value === 'phase') {
                resultDiv.innerHTML = '<p class="text-green-600"><i class="fas fa-check mr-2"></i>正确！相位变化最能反映人体移动。</p>';
                resultDiv.classList.remove('hidden');
                setTimeout(() => {
                    stageProgress[0] = 50;
                    updateProgress();
                }, 1000);
            } else {
                resultDiv.innerHTML = '<p class="text-red-600"><i class="fas fa-times mr-2"></i>不正确。相位变化对人体移动最敏感。</p>';
                resultDiv.classList.remove('hidden');
            }
        }

        // ESP32 functions
        function testESP32Connection() {
            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>连接中...';
            button.disabled = true;

            // Simulate connection test
            setTimeout(() => {
                button.innerHTML = '<i class="fas fa-check mr-2"></i>连接成功';
                button.className = 'mt-3 bg-green-500 text-white px-4 py-2 rounded';

                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.className = 'mt-3 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600';
                    button.disabled = false;
                }, 2000);
            }, 2000);
        }

        // Data collection functions
        function startDataCollection() {
            if (isDataCollecting) return;

            isDataCollecting = true;
            const interval = setInterval(() => {
                if (!isDataCollecting) {
                    clearInterval(interval);
                    return;
                }

                // Update CSI chart with new data
                const newData = Array.from({ length: 30 }, () => Math.random() * 100);
                charts.csiChart.data.datasets[0].data = newData;
                charts.csiChart.update();
            }, 1000);
        }

        function stopDataCollection() {
            isDataCollecting = false;
        }

        // Signal processing functions
        function applyFilter() {
            const selectedFilter = document.querySelector('input[name="filter"]:checked').value;

            // Generate new filtered signal
            const originalData = generateSignalData();
            let filteredData;

            switch (selectedFilter) {
                case 'mean':
                    filteredData = applyMeanFilter(originalData);
                    break;
                case 'median':
                    filteredData = applyMedianFilter(originalData);
                    break;
                case 'fft':
                    filteredData = applyFFTFilter(originalData);
                    break;
                case 'wavelet':
                    filteredData = applyWaveletFilter(originalData);
                    break;
                case 'emd':
                    filteredData = applyEMDFilter(originalData);
                    break;
                default:
                    filteredData = originalData;
            }

            // Update signal comparison chart
            charts.signalChart.data.datasets[0].data = originalData;
            charts.signalChart.data.datasets[1].data = filteredData;
            charts.signalChart.update();
        }

        // Filter implementations (simplified)
        function applyMeanFilter(data) {
            const windowSize = 5;
            return data.map((val, i) => {
                const start = Math.max(0, i - Math.floor(windowSize / 2));
                const end = Math.min(data.length, i + Math.floor(windowSize / 2) + 1);
                const window = data.slice(start, end);
                return window.reduce((a, b) => a + b, 0) / window.length;
            });
        }

        function applyMedianFilter(data) {
            const windowSize = 5;
            return data.map((val, i) => {
                const start = Math.max(0, i - Math.floor(windowSize / 2));
                const end = Math.min(data.length, i + Math.floor(windowSize / 2) + 1);
                const window = data.slice(start, end).sort((a, b) => a - b);
                return window[Math.floor(window.length / 2)];
            });
        }

        function applyFFTFilter(data) {
            // Simplified FFT filter simulation
            return data.map(val => val * 0.8 + Math.random() * 5);
        }

        function applyWaveletFilter(data) {
            // Simplified wavelet filter simulation
            return data.map(val => val * 0.9 + Math.random() * 3);
        }

        function applyEMDFilter(data) {
            // Simplified EMD filter simulation
            return data.map(val => val * 0.85 + Math.random() * 4);
        }

        // Feature extraction
        function extractFeatures() {
            const output = document.getElementById('code-output');
            output.classList.remove('hidden');
            output.innerHTML = `
特征提取完成：
- 振幅均值: 45.2
- 振幅标准差: 12.8
- 相位均值: 1.57
- 相位标准差: 0.89
- 特征向量维度: 12
            `;
        }

        // Model training
        function trainModel() {
            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>训练中...';
            button.disabled = true;

            let epoch = 0;
            const maxEpochs = 50;

            trainingInterval = setInterval(() => {
                epoch++;
                const trainAcc = Math.min(95, 60 + epoch * 0.7 + Math.random() * 5);
                const valAcc = Math.min(92, 55 + epoch * 0.6 + Math.random() * 4);

                // Update accuracy displays
                document.getElementById('train-accuracy').textContent = `${trainAcc.toFixed(1)}%`;
                document.getElementById('val-accuracy').textContent = `${valAcc.toFixed(1)}%`;

                // Update training chart
                charts.trainingChart.data.labels.push(epoch);
                charts.trainingChart.data.datasets[0].data.push(2.5 - epoch * 0.04 + Math.random() * 0.1);
                charts.trainingChart.data.datasets[1].data.push(valAcc);
                charts.trainingChart.update();

                if (epoch >= maxEpochs) {
                    clearInterval(trainingInterval);
                    button.innerHTML = '<i class="fas fa-check mr-2"></i>训练完成';
                    button.className = 'bg-green-500 text-white px-4 py-2 rounded w-full';

                    setTimeout(() => {
                        button.innerHTML = originalText;
                        button.className = 'bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600 w-full';
                        button.disabled = false;
                    }, 3000);
                }
            }, 200);
        }

        // Code execution
        function runCode(editorType) {
            const output = document.getElementById('code-output');
            output.classList.remove('hidden');

            switch (editorType) {
                case 'data-collection':
                    output.innerHTML = `
开始采集CSI数据，持续30秒...
Connected to ESP32 at 192.168.1.100
采集到 3000 个数据点
数据已保存到 csi_data.json
采集完成！
                    `;
                    break;
                case 'model-training':
                    output.innerHTML = `
模型创建完成，准备训练...
Epoch [0/50], Loss: 0.6931, Val Acc: 0.5200
Epoch [10/50], Loss: 0.4521, Val Acc: 0.7800
Epoch [20/50], Loss: 0.2341, Val Acc: 0.8900
训练完成！模型已保存。
                    `;
                    break;
                default:
                    output.innerHTML = '代码执行完成！';
            }
        }

        // Deployment functions
        function generateDeploymentScript() {
            alert('部署脚本已生成！请查看代码编辑器中的内容。');
        }

        // Project completion
        function completeProject() {
            // Update project summary
            document.getElementById('skills-learned').textContent = '15';
            document.getElementById('lines-of-code').textContent = '500+';
            document.getElementById('study-time').textContent = '24';

            // Show completion message
            alert('🎉 恭喜！您已完成WiFi智能感知项目！\n\n您已掌握：\n- WiFi CSI信号处理\n- 机器学习模型训练\n- 云端部署技术\n- Python编程技能');
        }

        // AI Assistant functions
        function toggleAIChat() {
            const panel = document.getElementById('ai-chat-panel');
            if (panel.style.display === 'none' || panel.style.display === '') {
                panel.style.display = 'flex';
            } else {
                panel.style.display = 'none';
            }
        }

        function handleAIInput(event) {
            if (event.key === 'Enter') {
                sendAIMessage();
            }
        }

        function sendAIMessage() {
            const input = document.getElementById('ai-input');
            const message = input.value.trim();

            if (!message) return;

            // Add user message
            addChatMessage(message, 'user');
            input.value = '';

            // Simulate AI response
            setTimeout(() => {
                const response = generateAIResponse(message);
                addChatMessage(response, 'ai');
            }, 1000);
        }

        function addChatMessage(message, sender) {
            const messagesContainer = document.getElementById('ai-chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            messageDiv.innerHTML = `<p>${message}</p>`;
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function generateAIResponse(userMessage) {
            const responses = {
                'csi': 'CSI（信道状态信息）是WiFi信号在传播过程中的特征参数，包括振幅、相位等信息。当人体经过时会改变这些参数。',
                '代码': '我可以帮您解释代码、调试错误或生成代码模板。请告诉我您需要什么帮助？',
                '错误': '请提供具体的错误信息，我会帮您分析问题并提供解决方案。',
                '模型': '对于WiFi感知，推荐使用GRU或LSTM模型处理时序数据。您可以根据数据复杂度选择合适的模型。',
                '部署': 'ECS部署需要配置Python环境、安装依赖、设置Nginx反向代理。我可以为您生成详细的部署脚本。'
            };

            for (const [key, response] of Object.entries(responses)) {
                if (userMessage.includes(key)) {
                    return response;
                }
            }

            return '我理解您的问题。作为AI编程助手，我可以帮您解决WiFi感知项目中的技术问题。请提供更多详细信息，我会给出针对性的建议。';
        }

        function getAIHelp(context) {
            toggleAIChat();

            const contextMessages = {
                'data-collection': '我看到您在学习数据采集。有什么关于ESP32或CSI数据采集的问题吗？',
                'feature-extraction': '特征提取是信号处理的重要步骤。需要我解释哪种特征提取方法？',
                'model-training': '模型训练遇到问题了吗？我可以帮您优化模型结构或调整超参数。',
                'deployment': '部署到ECS需要注意安全组配置和服务管理。有什么具体问题？'
            };

            const message = contextMessages[context] || '有什么我可以帮助您的吗？';
            setTimeout(() => {
                addChatMessage(message, 'ai');
            }, 500);
        }
    </script>
</body>

</html>
