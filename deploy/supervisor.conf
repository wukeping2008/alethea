# Supervisor配置文件 - /etc/supervisor/conf.d/alethea.conf

[program:alethea]
command=/home/alethea/alethea/venv/bin/gunicorn -c /home/alethea/alethea/deploy/gunicorn.conf.py src.main:app
directory=/home/alethea/alethea
user=alethea
group=alethea
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/var/log/alethea/supervisor.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=10
stderr_logfile=/var/log/alethea/supervisor_error.log
stderr_logfile_maxbytes=50MB
stderr_logfile_backups=10
environment=PATH="/home/alethea/alethea/venv/bin"
killasgroup=true
stopasgroup=true
stopsignal=TERM
stopwaitsecs=10
priority=999

# 环境变量
environment=
    FLASK_ENV="production",
    PYTHONPATH="/home/alethea/alethea",
    PATH="/home/alethea/alethea/venv/bin:%(ENV_PATH)s"

# 进程管理
numprocs=1
process_name=%(program_name)s_%(process_num)02d

# 启动配置
startsecs=10
startretries=3

# 日志轮转
logfile_maxbytes=50MB
logfile_backups=10
