# 阿里云ECS部署指南 - 服务器IP: 8.155.57.140

## 🚀 立即开始部署您的Alethea平台

### 服务器信息
- **服务器IP**: 8.155.57.140
- **实例ID**: i-f8zdzpazpk567qbg8caj
- **目标域名**: alethealab.cn, www.alethealab.cn

## 第一步：配置SSH访问

### 方法1：使用阿里云控制台重置密码

1. 登录阿里云ECS控制台：https://ecs.console.aliyun.com
2. 找到实例 `i-f8zdzpazpk567qbg8caj`
3. 点击"更多" → "密码/密钥" → "重置实例密码"
4. 设置root用户密码（建议使用强密码）
5. 重启ECS实例使密码生效

### 方法2：使用阿里云控制台的远程连接

1. 在ECS控制台找到您的实例
2. 点击"远程连接" → "通过Workbench远程连接"
3. 选择"立即登录"
4. 使用root用户登录

## 第二步：配置安全组（重要！）

确保以下端口已开放：

1. 在ECS控制台 → 网络与安全 → 安全组
2. 找到您实例的安全组，点击"配置规则"
3. 添加以下入方向规则：

| 端口范围 | 授权对象 | 描述 |
|----------|----------|------|
| 22/22 | 0.0.0.0/0 | SSH访问 |
| 80/80 | 0.0.0.0/0 | HTTP访问 |
| 443/443 | 0.0.0.0/0 | HTTPS访问 |
| 8083/8083 | 0.0.0.0/0 | 应用端口 |

## 第三步：测试SSH连接

在您的本地终端执行：

```bash
# 测试SSH连接
ssh root@8.155.57.140

# 如果提示输入密码，输入您在第一步设置的密码
```

## 第四步：自动部署脚本

一旦SSH连接成功，执行以下命令：

### 4.1 上传代码到服务器

```bash
# 在本地终端执行
cd /Users/kepingwu/Desktop/alethea
./deploy/upload_to_server.sh 8.155.57.140
```

### 4.2 连接到服务器并部署

```bash
# 连接到服务器
ssh root@8.155.57.140

# 在服务器上执行
cd /home/alethea/alethea
chmod +x deploy/aliyun_auto_deploy.sh
./deploy/aliyun_auto_deploy.sh
```

## 第五步：配置域名解析

在阿里云DNS控制台配置：

1. 登录阿里云控制台 → 域名与网站 → 云解析DNS
2. 找到域名 `alethealab.cn`
3. 添加以下解析记录：

| 记录类型 | 主机记录 | 记录值 |
|----------|----------|--------|
| A | @ | 8.155.57.140 |
| A | www | 8.155.57.140 |

## 第六步：配置环境变量

部署完成后，在服务器上配置API密钥：

```bash
# 编辑环境配置文件
nano /home/alethea/alethea/.env

# 配置以下内容：
FLASK_ENV=production
FLASK_DEBUG=False
SECRET_KEY=your_generated_secret_key

# AI服务配置（请填入您的实际API密钥）
OPENAI_API_KEY=sk-your-openai-api-key
CLAUDE_API_KEY=your-claude-api-key
GEMINI_API_KEY=your-gemini-api-key

# 域名配置
DOMAIN=alethealab.cn
WWW_DOMAIN=www.alethealab.cn

# 保存并退出（Ctrl+X, 然后Y, 然后Enter）

# 重启服务
systemctl restart alethea nginx
```

## 第七步：验证部署

```bash
# 检查服务状态
systemctl status alethea
systemctl status nginx

# 测试网站访问
curl http://localhost/
curl http://8.155.57.140/
```

## 🎯 部署成功标志

当您看到以下信息时，说明部署成功：

1. **服务状态正常**：
   ```bash
   systemctl status alethea  # 显示 active (running)
   systemctl status nginx    # 显示 active (running)
   ```

2. **网站可以访问**：
   - http://8.155.57.140
   - http://alethealab.cn（域名解析生效后）
   - http://www.alethealab.cn

3. **功能正常**：
   - 首页显示48个学科分类
   - AI问答功能正常工作
   - 各个页面导航正常

## 🚨 如果遇到问题

### SSH连接问题
```bash
# 如果SSH连接被拒绝，检查：
# 1. 安全组是否开放22端口
# 2. 服务器是否正在运行
# 3. 密码是否正确

# 使用阿里云控制台的远程连接作为备选方案
```

### 部署脚本失败
```bash
# 查看详细错误
journalctl -u alethea -n 50

# 手动安装依赖
apt update
apt install -y python3 python3-pip python3-venv nginx
```

### 网站无法访问
```bash
# 检查防火墙
ufw status

# 检查端口监听
netstat -tulpn | grep :80
netstat -tulpn | grep :8083

# 检查Nginx配置
nginx -t
```

## 📞 需要帮助？

如果在任何步骤遇到问题，请告诉我：

1. **具体的错误信息**
2. **执行到哪一步出现问题**
3. **服务器返回的日志信息**

我会立即帮您解决！

## 🎉 快速开始

**现在就开始第一步：**

1. 登录阿里云ECS控制台
2. 重置实例密码或使用远程连接
3. 配置安全组规则
4. 测试SSH连接：`ssh root@8.155.57.140`

**一旦SSH连接成功，整个部署过程只需要10-15分钟！**

---

**服务器准备就绪后，您的Alethea智能教育平台将在 http://alethealab.cn 正式上线！**
